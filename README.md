# ë„ì„œê´€ ê´€ë¦¬ ì‹œìŠ¤í…œ - TypeScript & NestJSë¡œ êµ¬í˜„í•œ DDD

**ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ ì…ë¬¸ìë¥¼ ìœ„í•œ ì‹¤ì „ í•™ìŠµ ìë£Œ**

[![TypeScript](https://img.shields.io/badge/TypeScript-4.4-blue)](https://www.typescriptlang.org/)
[![NestJS](https://img.shields.io/badge/NestJS-8.0-red)](https://nestjs.com/)
[![License](https://img.shields.io/badge/license-MIT-green)](LICENSE)

## ëª©ì°¨

- [í”„ë¡œì íŠ¸ ì†Œê°œ](#í”„ë¡œì íŠ¸-ì†Œê°œ)
- [DDD ì…ë¬¸ìë¥¼ ìœ„í•œ ì•ˆë‚´](#ddd-ì…ë¬¸ìë¥¼-ìœ„í•œ-ì•ˆë‚´)
- [ë¹ ë¥¸ ì‹œì‘](#ë¹ ë¥¸-ì‹œì‘)
- [ë„ë©”ì¸ ì„¤ëª…](#ë„ë©”ì¸-ì„¤ëª…)
- [ì•„í‚¤í…ì²˜ ê°œìš”](#ì•„í‚¤í…ì²˜-ê°œìš”)
    - [ì™œ í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ì¸ê°€?](#ì™œ-í—¥ì‚¬ê³ ë‚ -ì•„í‚¤í…ì²˜ì¸ê°€)
    - [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
    - [Bounded Context](#bounded-context)
- [ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ](#ë‹¨ê³„ë³„-êµ¬í˜„-ê°€ì´ë“œ)
- [í”„ë¡œì„¸ìŠ¤ ë°œê²¬](#í”„ë¡œì„¸ìŠ¤-ë°œê²¬)
- [NestJS í†µí•©](#nestjs-í†µí•©)
- [ê¸°ì—¬í•˜ê¸°](#ê¸°ì—¬í•˜ê¸°)
- [ì°¸ê³  ìë£Œ](#ì°¸ê³ -ìë£Œ)

---

## í”„ë¡œì íŠ¸ ì†Œê°œ

ì´ í”„ë¡œì íŠ¸ëŠ” ìœ ëª…í•œ [ddd-by-examples/library](https://github.com/ddd-by-examples/library) (ì›ë³¸ì€ Java)ë¥¼ **TypeScript/NestJSë¡œ ì¬êµ¬í˜„**í•œ ê²ƒì…ë‹ˆë‹¤.

**ì´ í”„ë¡œì íŠ¸ëŠ” ë¬´ì—‡ì¸ê°€ìš”?**
- ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(Domain-Driven Design, DDD) ì›ì¹™ìœ¼ë¡œ êµ¬ì¶•ëœ ì‹¤ì „ ë„ì„œê´€ ê´€ë¦¬ ì‹œìŠ¤í…œ
- DDD, Event Storming, í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ë¥¼ ì²˜ìŒ ë°°ìš°ëŠ” ê°œë°œìë¥¼ ìœ„í•œ í•™ìŠµ ìë£Œ
- TypeScriptë¡œ DDD ì „ìˆ ì  íŒ¨í„´(Aggregate, Value Object, Domain Event, Policy)ì„ ì ìš©í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì£¼ëŠ” ì˜ˆì œ

**ì›ë³¸ í”„ë¡œì íŠ¸ì™€ì˜ ì£¼ìš” ì°¨ì´ì :**
- **NestJS** í”„ë ˆì„ì›Œí¬ ì‚¬ìš© (ì›ë³¸ì€ Spring)
- **TypeScript**ì™€ **fp-ts**ë¡œ í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë° íŒ¨í„´ êµ¬í˜„
- **Nx**ë¥¼ ì‚¬ìš©í•œ ëª¨ë…¸ë ˆí¬ ê´€ë¦¬ (ëª¨ë“ˆì‹ ëª¨ë…¸ë¦¬ìŠ¤)
- **MikroORM**ì„ ì‚¬ìš©í•œ ì˜ì†ì„± ì²˜ë¦¬
- Node.js íŠ¹ìœ ì˜ ì œì•½ì‚¬í•­(ìˆœí™˜ ì°¸ì¡° ë“±) í•´ê²°

**í”„ë¡œì íŠ¸ ìƒíƒœ**: ì ê·¹ì ìœ¼ë¡œ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. ì¼ë¶€ ì†”ë£¨ì…˜ì€ ì‹¤í—˜ì ì´ë©° ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## DDD ì…ë¬¸ìë¥¼ ìœ„í•œ ì•ˆë‚´

**ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ê°€ ì²˜ìŒì´ì‹ ê°€ìš”?** ì´ í”„ë¡œì íŠ¸ëŠ” ì—¬ëŸ¬ë¶„ì„ ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤!

### ì¼ë°˜ì ì¸ CRUD ê°œë°œê³¼ DDDì˜ ì°¨ì´ì 

| ì „í†µì ì¸ CRUD | DDD ì ‘ê·¼ ë°©ì‹ |
|--------------|--------------|
| ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ë¶€í„° ì„¤ê³„ | ë¹„ì¦ˆë‹ˆìŠ¤ ë¬¸ì œë¶€í„° ì´í•´ |
| ì—”í‹°í‹° = í…Œì´ë¸” ë§¤í•‘ | ì—”í‹°í‹° = ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ê°€ì§„ ê°ì²´ |
| ëª¨ë“  ë¡œì§ì„ Serviceì— ì‘ì„± | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Domainì—, ServiceëŠ” ì¡°ìœ¨ë§Œ |
| DTO â†’ Entity â†’ DB | DTO â†’ Command â†’ Domain â†’ Event â†’ Repository |

### ì´ í”„ë¡œì íŠ¸ì—ì„œ ë°°ìš¸ ìˆ˜ ìˆëŠ” í•µì‹¬ DDD ê°œë…:

1. **Value Object** - ê°’ìœ¼ë¡œ ì‹ë³„ë˜ëŠ” ë¶ˆë³€ ê°ì²´ (ì˜ˆ: `PatronId`, `HoldDuration`)
2. **Entity** - ê³ ìœ í•œ ì‹ë³„ìë¥¼ ê°€ì§„ ê°ì²´ (ì˜ˆ: `AvailableBook`)
3. **Aggregate** - í•˜ë‚˜ì˜ ë‹¨ìœ„ë¡œ ì·¨ê¸‰ë˜ëŠ” ê°ì²´ ë¬¶ìŒ (ì˜ˆ: ì˜ˆì•½ì„ ê´€ë¦¬í•˜ëŠ” `Patron`)
4. **Domain Event** - ë°œìƒí•œ ì¤‘ìš”í•œ ì‚¬ì‹¤ (ì˜ˆ: `BookPlacedOnHold`, `BookHoldFailed`)
5. **Policy** - í”ŒëŸ¬ê·¸ ê°€ëŠ¥í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ (ì˜ˆ: "ì¼ë°˜ ì´ìš©ìëŠ” ìµœëŒ€ 5ê¶Œê¹Œì§€ ì˜ˆì•½ ê°€ëŠ¥")
6. **Bounded Context** - ëª…í™•í•œ ê²½ê³„ë¥¼ ê°€ì§„ ììœ¨ì  í•˜ìœ„ ì‹œìŠ¤í…œ (`Lending`, `Catalogue`)

### ì´ í”„ë¡œì íŠ¸ë¡œ DDDë¥¼ ë°°ì›Œì•¼ í•˜ëŠ” ì´ìœ 

- **ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ì¥ë‚œê° ì˜ˆì œê°€ ì•„ë‹Œ ì‹¤ì œ ë„ì„œê´€ ë„ë©”ì¸ ë¡œì§
- **ë‹¨ê³„ë³„ ê°€ì´ë“œ**: [STEP.md](./STEP.md)ì—ì„œ ì™„ì „í•œ ì´ˆë³´ì íŠœí† ë¦¬ì–¼ ì œê³µ
- **ì‹¤ìš©ì ì¸ íŒ¨í„´**: DDD íŒ¨í„´ì´ ì‹¤ì œ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•˜ëŠ”ì§€ í™•ì¸ (ì´ë¡ ë§Œì´ ì•„ë‹˜)
- **ìµœì‹  ê¸°ìˆ  ìŠ¤íƒ**: TypeScript, NestJS, í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°(fp-ts)ìœ¼ë¡œ DDD í•™ìŠµ
- **í…ŒìŠ¤íŠ¸ ì£¼ë„**: ê´‘ë²”ìœ„í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦ ë°©ë²• í•™ìŠµ

---

## ë¹ ë¥¸ ì‹œì‘

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Node.js 20+
- Docker & Docker Compose (PostgreSQLìš©)
- pnpm ë˜ëŠ” bun

### ì„¤ì¹˜ ë° ì‹¤í–‰

```bash
# 1. ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/MoonDongmin/library-ddd.git
cd library-nestjs

# 2. ì˜ì¡´ì„± ì„¤ì¹˜
bun install

# 3. PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì‹œì‘
docker-compose up -d

# 4. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
bunx mikro-orm migration:up

# 5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
bun start
# ë˜ëŠ”
nx serve library

# 6. API ì ‘ê·¼
# APIëŠ” http://localhost:3000ì—ì„œ ì‚¬ìš© ê°€ëŠ¥
# Swagger ë¬¸ì„œëŠ” http://localhost:3000/api
```

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
bun test

# íŠ¹ì • ë¼ì´ë¸ŒëŸ¬ë¦¬ í…ŒìŠ¤íŠ¸
nx test lending-domain
nx test lending-application

# ì»¤ë²„ë¦¬ì§€ í¬í•¨ í…ŒìŠ¤íŠ¸
nx test lending-domain --coverage

# E2E í…ŒìŠ¤íŠ¸
nx e2e library-e2e
```

### API í˜¸ì¶œ ì˜ˆì œ

```bash
# ì±… ì˜ˆì•½í•˜ê¸°
curl -X POST http://localhost:3000/lending/holds \
  -H "Content-Type: application/json" \
  -d '{
    "patronId": "patron-123",
    "bookId": "book-456",
    "libraryBranchId": "branch-789",
    "numberOfDays": 5
  }'
```

---

## ë„ë©”ì¸ ì„¤ëª…

**ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸**: ê³µê³µ ë„ì„œê´€ ê´€ë¦¬ ì‹œìŠ¤í…œ

ê³µê³µ ë„ì„œê´€ì€ ì´ìš©ì(patron)ê°€ ë‹¤ì–‘í•œ ë„ì„œê´€ ì§€ì ì—ì„œ ì±…ì„ ì˜ˆì•½í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
ëŒ€ì¶œ ê°€ëŠ¥í•œ ì±…ì€ ì£¼ì–´ì§„ ì‹œì ì— í•œ ëª…ì˜ ì´ìš©ìë§Œ ì˜ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì±…ì€ ì¼ë°˜ ë„ì„œ(circulating) ë˜ëŠ” ì œí•œ ë„ì„œ(restricted)ì´ë©°, ë°˜ë‚© ìˆ˜ìˆ˜ë£Œë‚˜ ì‚¬ìš© ìˆ˜ìˆ˜ë£Œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì œí•œ ë„ì„œëŠ” ì—°êµ¬ì ì´ìš©ìë§Œ ì˜ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ ì´ìš©ìëŠ” ì£¼ì–´ì§„ ì‹œì ì— ìµœëŒ€ 5ê¶Œê¹Œì§€ë§Œ ì˜ˆì•½í•  ìˆ˜ ìˆì§€ë§Œ,
ì—°êµ¬ì ì´ìš©ìëŠ” ë¬´ì œí•œìœ¼ë¡œ ì˜ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬´ê¸°í•œ ì˜ˆì•½(open-ended hold)ì€ ì´ìš©ìê°€ ì±…ì„ ëŒ€ì¶œí•  ë•Œê¹Œì§€
í™œì„± ìƒíƒœì´ë©°, ëŒ€ì¶œ ì‹œ ì™„ë£Œë©ë‹ˆë‹¤. ì •í•´ì§„ ê¸°ê°„(close-ended) ì˜ˆì•½ì´ ìš”ì²­ í›„ ì¼ì • ê¸°ê°„ ë‚´ì— ì™„ë£Œë˜ì§€ ì•Šìœ¼ë©´
ë§Œë£Œë©ë‹ˆë‹¤. ì´ëŠ” ë§Œë£Œë˜ëŠ” ì˜ˆì•½ì´ ìˆëŠ” ì¼ì¼ ì‹œíŠ¸(daily sheet)ë¥¼ í™•ì¸í•˜ì—¬ í•˜ë£¨ì˜ ì‹œì‘ ì‹œì ì— ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
ì—°êµ¬ì ì´ìš©ìë§Œ ë¬´ê¸°í•œ ì˜ˆì•½ ê¸°ê°„ì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„ì„œê´€ ì§€ì ì—ì„œ 2íšŒ ì´ìƒì˜ ì—°ì²´ ëŒ€ì¶œì´ ìˆëŠ” ì´ìš©ìëŠ”
ë™ì¼í•œ ë„ì„œê´€ ì§€ì ì—ì„œ ì˜ˆì•½ì„ ì‹œë„í•˜ë©´ ê±°ë¶€ë©ë‹ˆë‹¤. ì±…ì€ ìµœëŒ€ 60ì¼ ë™ì•ˆ ëŒ€ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—°ì²´ ëŒ€ì¶œ í™•ì¸ì€
ì—°ì²´ ëŒ€ì¶œì´ ìˆëŠ” ì¼ì¼ ì‹œíŠ¸ë¥¼ í™•ì¸í•˜ì—¬ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ì´ìš©ìëŠ” í”„ë¡œí•„(patron profile)ì„ í†µí•´ í˜„ì¬ ì˜ˆì•½,
ëŒ€ì¶œ ë“±ê³¼ ìƒí˜¸ì‘ìš©í•©ë‹ˆë‹¤. ì´ìš©ì í”„ë¡œí•„ì€ ì¼ì¼ ì‹œíŠ¸ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ì •ë³´ê°€ í•œ ëª…ì˜ ì´ìš©ìë¡œ ì œí•œë˜ë©°
ë°˜ë“œì‹œ ì¼ì¼ ë‹¨ìœ„ì¼ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. í˜„ì¬ ì´ìš©ìëŠ” í˜„ì¬ ì˜ˆì•½(ì·¨ì†Œë˜ê±°ë‚˜ ë§Œë£Œë˜ì§€ ì•Šì€)ê³¼ í˜„ì¬ ëŒ€ì¶œ(ì—°ì²´ í¬í•¨)ì„
ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì±…ì„ ì˜ˆì•½í•˜ê³  ì˜ˆì•½ì„ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ìš©ìê°€ ëŒ€ì¶œ ê°€ëŠ¥í•œ ì±…ì„ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆì„ê¹Œìš”? ë„ì„œê´€ì—ëŠ” ì±…ê³¼ ê·¸ íŠ¹ì • ì¸ìŠ¤í„´ìŠ¤ê°€ í•¨ê»˜ ì¶”ê°€ë˜ëŠ” ì¹´íƒˆë¡œê·¸ê°€
ìˆìŠµë‹ˆë‹¤. íŠ¹ì • ì±… ì¸ìŠ¤í„´ìŠ¤ëŠ” ì¹´íƒˆë¡œê·¸ì— ì¼ì¹˜í•˜ëŠ” ISBNì´ ìˆëŠ” ì±…ì´ ì´ë¯¸ ìˆëŠ” ê²½ìš°ì—ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì±…ì€ ë¹„ì–´ ìˆì§€ ì•Šì€ ì œëª©ê³¼ ê°€ê²©ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¶”ê°€í•  ë•Œ ì¼ë°˜ ë„ì„œì¸ì§€ ì œí•œ ë„ì„œì¸ì§€ ê²°ì •í•©ë‹ˆë‹¤.
ì´ë¥¼ í†µí•´ ë™ì¼í•œ ISBNì˜ ì±…ì„ ì¼ë°˜ ë„ì„œì™€ ì œí•œ ë„ì„œë¡œ ë™ì‹œì— ë³´ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
(ì˜ˆ: ì €ìê°€ ì„œëª…í•œ ì±…ì„ ì œí•œ ë„ì„œë¡œ ë³´ê´€í•˜ë ¤ëŠ” ê²½ìš°).

---

## ì•„í‚¤í…ì²˜ ê°œìš”

### ì™œ í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ì¸ê°€?

**Lending** ì»¨í…ìŠ¤íŠ¸ëŠ” **í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜**(Ports & Adapters)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤:
- **í”„ë ˆì„ì›Œí¬ ë…ë¦½ì„±**: ë„ë©”ì¸ ë¡œì§ì´ NestJS, ë°ì´í„°ë² ì´ìŠ¤, HTTPì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- **í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±**: ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì™¸ë¶€ ì˜ì¡´ì„± ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **ìœ ì—°ì„±**: ì¸í”„ë¼ êµì²´(ì˜ˆ: PostgreSQL â†’ MongoDB)ê°€ ë„ë©”ì¸ ì½”ë“œ ìˆ˜ì • ì—†ì´ ê°€ëŠ¥

**í•µì‹¬ ì›ì¹™**: ì˜ì¡´ì„±ì€ ì•ˆìª½ì„ í–¥í•©ë‹ˆë‹¤. Domainì´ ì¤‘ì‹¬ì— ìˆê³ , ì™¸ë¶€ ì„¸ê³„ë¥¼ ì•Œì§€ ëª»í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI Layer (ui-rest/)                â”‚  â† HTTP ìš”ì²­
â”‚  - Controller, DTO                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ (Facade í˜¸ì¶œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Layer (application/)   â”‚  â† ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¡°ìœ¨
â”‚  - Command, Handler, Port           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ (Domain í˜¸ì¶œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Domain Layer (domain/)             â”‚  â† í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚  - Entity, Value Object, Policy     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘ (Port êµ¬í˜„)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Infrastructure Layer (infra/)      â”‚  â† ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­
â”‚  - Repository, Database Entity      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í”„ë¡œì íŠ¸ êµ¬ì¡°

ì‹œìŠ¤í…œì€ Nx ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ **ëª¨ë“ˆì‹ ëª¨ë…¸ë¦¬ìŠ¤**ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

```
â””â”€â”€ libs/
    â”œâ”€â”€ catalogue/              # ë‹¨ìˆœ CRUD ì»¨í…ìŠ¤íŠ¸
    â”‚   â””â”€â”€ src/
    â”œâ”€â”€ lending/                # ë³µì¡í•œ DDD ì»¨í…ìŠ¤íŠ¸
    â”‚   â”œâ”€â”€ domain/             # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (í”„ë ˆì„ì›Œí¬ ë¬´ê´€)
    â”‚   â”‚   â”œâ”€â”€ /book
    â”‚   â”‚   â”œâ”€â”€ /patron
    â”‚   â”‚   â””â”€â”€ /policies
    â”‚   â”œâ”€â”€ application/        # ìœ ìŠ¤ì¼€ì´ìŠ¤ (CQRS)
    â”‚   â”œâ”€â”€ infrastructure/     # ì˜ì†ì„± (MikroORM)
    â”‚   â””â”€â”€ ui-rest/            # REST API
    â””â”€â”€ shared/                 # ê³µí†µ ìœ í‹¸ë¦¬í‹°
```

**ì´ëŸ° êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ :**
- ê° Bounded Contextê°€ ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ â†’ ëª…í™•í•œ ê²½ê³„
- Lendingì€ í—¥ì‚¬ê³ ë‚  ë ˆì´ì–´ ì‚¬ìš© â†’ ë³µì¡í•œ ë„ë©”ì¸ ë¡œì§
- CatalogueëŠ” ë‹¨ìˆœ â†’ ë ˆì´ì–´ ì—†ëŠ” CRUD
- Nxê°€ ëª¨ë“ˆ ê²½ê³„ ê°•ì œ â†’ ì˜ë„ì¹˜ ì•Šì€ ê²°í•© ë°©ì§€

### Bounded Context

#### 1. **Lending Context** (ë³µì¡í•œ ë„ë©”ì¸)

**ì±…ì„**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ê°€ì§„ ì±… ì˜ˆì•½ ë° ëŒ€ì¶œ ê´€ë¦¬

**ì£¼ìš” Aggregate:**
- `Patron` - ì˜ˆì•½ ì œí•œ, ì—°ì²´ í™•ì¸ ê°•ì œ
- `Book` - ê°€ìš©ì„± ìƒíƒœ ê´€ë¦¬

**ì£¼ìš” Policy:**
- `onlyResearcherCanHoldRestrictedBooks`
- `regularPatronMaximumNumberOfHolds`

**Domain Event:**
- `BookPlacedOnHold`, `BookHoldFailed`, `BookHoldCanceled`, `BookCheckedOut`

#### 2. **Catalogue Context** (ë‹¨ìˆœ CRUD)

**ì±…ì„**: ë„ì„œ ì¹´íƒˆë¡œê·¸ ë° ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬

**ì‘ì—…:**
- ì¹´íƒˆë¡œê·¸ì— ì±… ì¶”ê°€
- ì±… ì¸ìŠ¤í„´ìŠ¤ ì¶”ê°€ (ì¼ë°˜/ì œí•œ)
- ëŒ€ì¶œ ê°€ëŠ¥í•œ ì±… ì¡°íšŒ

---

## ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ

**Lending ì»¨í…ìŠ¤íŠ¸ì— ìƒˆ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?**

ì²˜ìŒë¶€í„° ëê¹Œì§€ ìƒˆë¡œìš´ ê¸°ëŠ¥(ì˜ˆ: "ì±… ì˜ˆì•½í•˜ê¸°")ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•˜ëŠ” í¬ê´„ì ì´ê³  ì´ˆë³´ì ì¹œí™”ì ì¸ ê°€ì´ë“œë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

**ğŸ“– [ì™„ì „í•œ ê°€ì´ë“œ ì½ê¸°: STEP.md](./STEP.md)**

ê°€ì´ë“œ ë‚´ìš©:
- **0. ì„¤ê³„ ë‹¨ê³„** - ì½”ë”© ì „ ìš”êµ¬ì‚¬í•­ ì´í•´
- **1. Domain ë ˆì´ì–´** - Value Object, Entity, Aggregate, Policy
- **2. Application ë ˆì´ì–´** - Command, Handler, Port
- **3. Infrastructure ë ˆì´ì–´** - Repository, Database Entity, Migration
- **4. UI ë ˆì´ì–´** - REST Controller, DTO
- **5. í…ŒìŠ¤íŒ…** - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸, E2E í…ŒìŠ¤íŠ¸

ê° ë‹¨ê³„ì—ëŠ” ë‹¤ìŒì´ í¬í•¨ë©ë‹ˆë‹¤:
- âœ… ì™œ ì´ë ‡ê²Œ í•´ì•¼ í•˜ëŠ”ì§€
- âœ… í”¼í•´ì•¼ í•  ì¼ë°˜ì ì¸ ì‹¤ìˆ˜
- âœ… ë³µì‚¬í•  ìˆ˜ ìˆëŠ” ì‹¤ì œ ì½”ë“œ ì˜ˆì œ
- âœ… ì˜¬ë°”ë¥´ê²Œ í–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸

---

## í”„ë¡œì„¸ìŠ¤ ë°œê²¬

### Event Storming

ìš°ë¦¬ê°€ ì‹œì‘í•œ ì²« ë²ˆì§¸ ì‘ì—…ì€ Big Picture EventStormingì„ í†µí•œ ë„ë©”ì¸ íƒìƒ‰ì´ì—ˆìŠµë‹ˆë‹¤.
ì´ì „ ì¥ì—ì„œ ì°¾ì€ ì„¤ëª…ì´ ìš°ë¦¬ì˜ ê°€ìƒ ë²½ì— ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤:
![Event Storming ë„ë©”ì¸ ì„¤ëª…](docs/images/eventstorming-domain-desc.png)
EventStorming ì„¸ì…˜ì€ ë§ì€ ë°œê²¬ìœ¼ë¡œ ì´ì–´ì¡Œê³ , í¬ìŠ¤íŠ¸ì‡ìœ¼ë¡œ ëª¨ë¸ë§í–ˆìŠµë‹ˆë‹¤:
![Event Storming Big Picture](docs/images/eventstorming-big-picture.jpg)
ì„¸ì…˜ ì¤‘ì— ë‹¤ìŒ ì •ì˜ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤:
![Event Storming ì •ì˜](docs/images/eventstorming-definitions.png)

ì´ë¥¼ í†µí•´ ì‹¤ì œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒê°í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. **Example mapping**ì˜ ë„ì›€ìœ¼ë¡œ
ë°œê²¬í•œ ë‚´ìš©ì„ ì„¤ëª…í–ˆìŠµë‹ˆë‹¤:
![Example mapping](docs/images/example-mapping.png)

ì´ëŠ” ê° ì˜ˆì œë¥¼ ë¶„ì„í•œ _Design Level_ ì„¸ì…˜ì˜ ê¸°ì´ˆê°€ ë˜ì—ˆìŠµë‹ˆë‹¤:
![Example mapping](docs/images/eventstorming-design-level.jpg)

ì–¸ê¸‰ëœ ê° ë‹¨ê³„ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ì•„ë˜ ë§í¬ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”:

- [Big Picture EventStorming](./docs/big-picture.md)
- [Example Mapping](docs/example-mapping.md)
- [Design Level EventStorming](docs/design-level.md)

---

## NestJS í†µí•©

### í”„ë ˆì„ì›Œí¬ ì² í•™

Spring ì˜ì¡´ì„±ì„ ìµœì†Œí™”í•œ ì›ë³¸ Java ë²„ì „ê³¼ ë‹¬ë¦¬, ì´ êµ¬í˜„ì€ **NestJSë¥¼ ì‹¤ìš©ì ìœ¼ë¡œ ìˆ˜ìš©**í•©ë‹ˆë‹¤.

**ì™œ NestJSì¸ê°€?**
- ê³ ê¸‰ ì˜ì¡´ì„± ì£¼ì…(Dependency Injection) ì‹œìŠ¤í…œ
- TypeScript ìš°ì„  ì„¤ê³„
- ë‚´ì¥ CQRS ì§€ì› (`@nestjs/cqrs`)
- í‘œì¤€í™”ëœ ëª¨ë“ˆ êµ¬ì¡°
- í™œë°œí•œ ìƒíƒœê³„

**DDD ì›ì¹™ê³¼ í”„ë ˆì„ì›Œí¬ ì‹¤ìš©ì„±ì˜ ê· í˜•**

Eric Evansê°€ *Domain-Driven Design*ì—ì„œ ì“´ ê²ƒì²˜ëŸ¼:

> ìµœê³ ì˜ ì•„í‚¤í…ì²˜ í”„ë ˆì„ì›Œí¬ëŠ” ë„ë©”ì¸ ê°œë°œìê°€ ëª¨ë¸ í‘œí˜„ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë„ë¡ í•˜ë©´ì„œ ë³µì¡í•œ ê¸°ìˆ  ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
> ê·¸ëŸ¬ë‚˜ í”„ë ˆì„ì›Œí¬ëŠ” ë„ë©”ì¸ ì„¤ê³„ ì„ íƒì„ ì œì•½í•˜ëŠ” ë„ˆë¬´ ë§ì€ ê°€ì •ì„ í•˜ê±°ë‚˜ êµ¬í˜„ì„ ë„ˆë¬´ ë¬´ê²ê²Œ ë§Œë“¤ì–´ ê°œë°œ ì†ë„ë¥¼
> ëŠ¦ì¶¤ìœ¼ë¡œì¨ ì‰½ê²Œ ë°©í•´ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ìš°ë¦¬ì˜ ì ‘ê·¼ ë°©ì‹:**

| ë ˆì´ì–´ | í”„ë ˆì„ì›Œí¬ ì‚¬ìš© | ì´ìœ  |
|-------|----------------|------|
| **Domain** | ì—†ìŒ (ìˆœìˆ˜ TypeScript + fp-ts) | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ í”„ë ˆì„ì›Œí¬ ë…ë¦½ì ì´ì–´ì•¼ í•¨ |
| **Application** | NestJS CQRS, DI | ë„ë©”ì¸ì„ ì˜¤ì—¼ì‹œí‚¤ì§€ ì•Šê³  ì»¤ë§¨ë“œ/ì´ë²¤íŠ¸ ì²˜ë¦¬ ë‹¨ìˆœí™” |
| **Infrastructure** | NestJS ëª¨ë“ˆ, MikroORM | ê¸°ìˆ ì  ê´€ì‹¬ì‚¬ì— í”„ë ˆì„ì›Œí¬ í™œìš© |
| **UI** | NestJS ì»¨íŠ¸ë¡¤ëŸ¬, ë°ì½”ë ˆì´í„° | í‘œì¤€ REST API íŒ¨í„´ |

**ì˜ˆì œ: Domainì„ ìˆœìˆ˜í•˜ê²Œ ìœ ì§€í•˜ê¸°**

```typescript
// âœ… Domain Layer - í”„ë ˆì„ì›Œí¬ ì˜ì¡´ì„± ì—†ìŒ
export class Patron {
  placeOnHold(
    book: AvailableBook,
    duration: HoldDuration
  ): Either<BookHoldFailed, BookPlacedOnHold> {
    // fp-tsë¥¼ ì‚¬ìš©í•œ ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    const rejection = this.patronCanHold(book, duration);
    return isNone(rejection)
      ? right(new BookPlacedOnHold(...))
      : left(BookHoldFailed.bookHoldFailedNow(...));
  }
}

// âœ… Application Layer - NestJSë¥¼ ì‹¤ìš©ì ìœ¼ë¡œ ì‚¬ìš©
@CommandHandler(PlaceOnHoldCommand)
export class PlaceOnHoldHandler implements ICommandHandler<PlaceOnHoldCommand> {
  constructor(
    private readonly patronRepository: PatronRepository,
    private readonly eventPublisher: EventPublisher
  ) {}

  async execute(command: PlaceOnHoldCommand): Promise<void> {
    const patron = await this.patronRepository.findById(patronId);
    const result = patron.placeOnHold(book, duration); // ë„ë©”ì¸ í˜¸ì¶œ
    // ê²°ê³¼ ì²˜ë¦¬, ì´ë²¤íŠ¸ ë°œí–‰
  }
}
```

**ì´ ì ‘ê·¼ ë°©ì‹ì˜ ì¥ì :**
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹¤ì‹œ ì‘ì„±í•˜ì§€ ì•Šê³  NestJSë¥¼ ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ë¡œ êµì²´ ê°€ëŠ¥
- ë„ë©”ì¸ í…ŒìŠ¤íŠ¸ê°€ ë¹ ë¦„ (í”„ë ˆì„ì›Œí¬ ë¶€íŠ¸ìŠ¤íŠ¸ë© ì—†ìŒ)
- ê°œë°œìê°€ DDD ì›ì¹™ì„ í¬ìƒí•˜ì§€ ì•Šê³  NestJSì˜ ìƒì‚°ì„± ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥

### ì¶”ê°€ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

**ì»´í¬ë„ŒíŠ¸ ë‹¤ì´ì–´ê·¸ë¨:**

![Component diagram](docs/c4/component-diagram.png)

**Node.js ì œì•½ì‚¬í•­ ì²˜ë¦¬:**

ê° ë¹„ì¦ˆë‹ˆìŠ¤ ê°ì²´ê°€ ìì²´ í—¥ì‚¬ê³ ë‚  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°€ì§„ Java ë²„ì „ê³¼ ë‹¬ë¦¬, ìš°ë¦¬ëŠ” ê´€ë ¨ ê°ì²´ë¥¼ ë ˆì´ì–´ë³„ ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ
ë³‘í•©í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„œë¡œ ë§ì´ ì˜ì¡´í•  ë•Œ Node.jsì—ì„œ í”í•œ ìˆœí™˜ ì°¸ì¡° ë¬¸ì œë¥¼ í”¼í•©ë‹ˆë‹¤.

---

## ì°¸ê³  ìë£Œ

1. [Introducing EventStorming](https://leanpub.com/introducing_eventstorming) by Alberto Brandolini
2. [Domain Modelling Made Functional](https://pragprog.com/book/swdddf/domain-modeling-made-functional) by Scott Wlaschin
3. [Software Architecture for Developers](https://softwarearchitecturefordevelopers.com) by Simon Brown
4. [Clean Architecture](https://www.amazon.com/Clean-Architecture-Craftsmans-Software-Structure/dp/0134494164) by Robert C. Martin
5. [Domain-Driven Design: Tackling Complexity in the Heart of Software](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215) by Eric Evans
